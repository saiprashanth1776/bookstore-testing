{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar tslib_1 = require(\"tslib\");\n\nvar util_1 = require(\"@firebase/util\");\n\nvar util_2 = require(\"../../util/util\");\n\nvar Index_1 = require(\"./Index\");\n\nvar ChildrenNode_1 = require(\"../ChildrenNode\");\n\nvar Node_1 = require(\"../Node\");\n\nvar nodeFromJSON_1 = require(\"../nodeFromJSON\");\n/**\n * @param {!Path} indexPath\n * @constructor\n * @extends {Index}\n */\n\n\nvar PathIndex =\n/** @class */\nfunction (_super) {\n  tslib_1.__extends(PathIndex, _super);\n\n  function PathIndex(indexPath_) {\n    var _this = _super.call(this) || this;\n\n    _this.indexPath_ = indexPath_;\n    util_1.assert(!indexPath_.isEmpty() && indexPath_.getFront() !== '.priority', \"Can't create PathIndex with empty path or .priority key\");\n    return _this;\n  }\n  /**\n   * @param {!Node} snap\n   * @return {!Node}\n   * @protected\n   */\n\n\n  PathIndex.prototype.extractChild = function (snap) {\n    return snap.getChild(this.indexPath_);\n  };\n  /**\n   * @inheritDoc\n   */\n\n\n  PathIndex.prototype.isDefinedOn = function (node) {\n    return !node.getChild(this.indexPath_).isEmpty();\n  };\n  /**\n   * @inheritDoc\n   */\n\n\n  PathIndex.prototype.compare = function (a, b) {\n    var aChild = this.extractChild(a.node);\n    var bChild = this.extractChild(b.node);\n    var indexCmp = aChild.compareTo(bChild);\n\n    if (indexCmp === 0) {\n      return util_2.nameCompare(a.name, b.name);\n    } else {\n      return indexCmp;\n    }\n  };\n  /**\n   * @inheritDoc\n   */\n\n\n  PathIndex.prototype.makePost = function (indexValue, name) {\n    var valueNode = nodeFromJSON_1.nodeFromJSON(indexValue);\n    var node = ChildrenNode_1.ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, valueNode);\n    return new Node_1.NamedNode(name, node);\n  };\n  /**\n   * @inheritDoc\n   */\n\n\n  PathIndex.prototype.maxPost = function () {\n    var node = ChildrenNode_1.ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, ChildrenNode_1.MAX_NODE);\n    return new Node_1.NamedNode(util_2.MAX_NAME, node);\n  };\n  /**\n   * @inheritDoc\n   */\n\n\n  PathIndex.prototype.toString = function () {\n    return this.indexPath_.slice().join('/');\n  };\n\n  return PathIndex;\n}(Index_1.Index);\n\nexports.PathIndex = PathIndex;","map":{"version":3,"sources":["../src/core/snap/indexes/PathIndex.ts"],"names":[],"mappings":";AAAA;;;;;;;;;;;;;;;;;;;;;;AAgBA,IAAA,MAAA,GAAA,OAAA,CAAA,gBAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,iBAAA,CAAA;;AACA,IAAA,OAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;AACA,IAAA,cAAA,GAAA,OAAA,CAAA,iBAAA,CAAA;;AACA,IAAA,MAAA,GAAA,OAAA,CAAA,SAAA,CAAA;;AACA,IAAA,cAAA,GAAA,OAAA,CAAA,iBAAA,CAAA;AAGA;;;;;;;AAKA,IAAA,SAAA;AAAA;AAAA,UAAA,MAAA,EAAA;AAA+B,EAAA,OAAA,CAAA,SAAA,CAAA,SAAA,EAAA,MAAA;;AAC7B,WAAA,SAAA,CAAoB,UAApB,EAAoC;AAApC,QAAA,KAAA,GACE,MAAA,CAAA,IAAA,CAAA,IAAA,KAAO,IADT;;AAAoB,IAAA,KAAA,CAAA,UAAA,GAAA,UAAA;AAGlB,IAAA,MAAA,CAAA,MAAA,CACE,CAAC,UAAU,CAAC,OAAX,EAAD,IAAyB,UAAU,CAAC,QAAX,OAA0B,WADrD,EAEE,yDAFF;;AAID;AAED;;;;;;;AAKU,EAAA,SAAA,CAAA,SAAA,CAAA,YAAA,GAAV,UAAuB,IAAvB,EAAiC;AAC/B,WAAO,IAAI,CAAC,QAAL,CAAc,KAAK,UAAnB,CAAP;AACD,GAFS;AAIV;;;;;AAGA,EAAA,SAAA,CAAA,SAAA,CAAA,WAAA,GAAA,UAAY,IAAZ,EAAsB;AACpB,WAAO,CAAC,IAAI,CAAC,QAAL,CAAc,KAAK,UAAnB,EAA+B,OAA/B,EAAR;AACD,GAFD;AAIA;;;;;AAGA,EAAA,SAAA,CAAA,SAAA,CAAA,OAAA,GAAA,UAAQ,CAAR,EAAsB,CAAtB,EAAkC;AAChC,QAAM,MAAM,GAAG,KAAK,YAAL,CAAkB,CAAC,CAAC,IAApB,CAAf;AACA,QAAM,MAAM,GAAG,KAAK,YAAL,CAAkB,CAAC,CAAC,IAApB,CAAf;AACA,QAAM,QAAQ,GAAG,MAAM,CAAC,SAAP,CAAiB,MAAjB,CAAjB;;AACA,QAAI,QAAQ,KAAK,CAAjB,EAAoB;AAClB,aAAO,MAAA,CAAA,WAAA,CAAY,CAAC,CAAC,IAAd,EAAoB,CAAC,CAAC,IAAtB,CAAP;AACD,KAFD,MAEO;AACL,aAAO,QAAP;AACD;AACF,GATD;AAWA;;;;;AAGA,EAAA,SAAA,CAAA,SAAA,CAAA,QAAA,GAAA,UAAS,UAAT,EAA6B,IAA7B,EAAyC;AACvC,QAAM,SAAS,GAAG,cAAA,CAAA,YAAA,CAAa,UAAb,CAAlB;AACA,QAAM,IAAI,GAAG,cAAA,CAAA,YAAA,CAAa,UAAb,CAAwB,WAAxB,CACX,KAAK,UADM,EAEX,SAFW,CAAb;AAIA,WAAO,IAAI,MAAA,CAAA,SAAJ,CAAc,IAAd,EAAoB,IAApB,CAAP;AACD,GAPD;AASA;;;;;AAGA,EAAA,SAAA,CAAA,SAAA,CAAA,OAAA,GAAA,YAAA;AACE,QAAM,IAAI,GAAG,cAAA,CAAA,YAAA,CAAa,UAAb,CAAwB,WAAxB,CAAoC,KAAK,UAAzC,EAAqD,cAAA,CAAA,QAArD,CAAb;AACA,WAAO,IAAI,MAAA,CAAA,SAAJ,CAAc,MAAA,CAAA,QAAd,EAAwB,IAAxB,CAAP;AACD,GAHD;AAKA;;;;;AAGA,EAAA,SAAA,CAAA,SAAA,CAAA,QAAA,GAAA,YAAA;AACE,WAAO,KAAK,UAAL,CAAgB,KAAhB,GAAwB,IAAxB,CAA6B,GAA7B,CAAP;AACD,GAFD;;AAGF,SAAA,SAAA;AAAC,CAlED,CAA+B,OAAA,CAAA,KAA/B,CAAA;;AAAa,OAAA,CAAA,SAAA,GAAA,SAAA","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { nameCompare, MAX_NAME } from '../../util/util';\nimport { Index } from './Index';\nimport { ChildrenNode, MAX_NODE } from '../ChildrenNode';\nimport { NamedNode, Node } from '../Node';\nimport { nodeFromJSON } from '../nodeFromJSON';\nimport { Path } from '../../util/Path';\n\n/**\n * @param {!Path} indexPath\n * @constructor\n * @extends {Index}\n */\nexport class PathIndex extends Index {\n  constructor(private indexPath_: Path) {\n    super();\n\n    assert(\n      !indexPath_.isEmpty() && indexPath_.getFront() !== '.priority',\n      \"Can't create PathIndex with empty path or .priority key\"\n    );\n  }\n\n  /**\n   * @param {!Node} snap\n   * @return {!Node}\n   * @protected\n   */\n  protected extractChild(snap: Node): Node {\n    return snap.getChild(this.indexPath_);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  isDefinedOn(node: Node): boolean {\n    return !node.getChild(this.indexPath_).isEmpty();\n  }\n\n  /**\n   * @inheritDoc\n   */\n  compare(a: NamedNode, b: NamedNode): number {\n    const aChild = this.extractChild(a.node);\n    const bChild = this.extractChild(b.node);\n    const indexCmp = aChild.compareTo(bChild);\n    if (indexCmp === 0) {\n      return nameCompare(a.name, b.name);\n    } else {\n      return indexCmp;\n    }\n  }\n\n  /**\n   * @inheritDoc\n   */\n  makePost(indexValue: object, name: string): NamedNode {\n    const valueNode = nodeFromJSON(indexValue);\n    const node = ChildrenNode.EMPTY_NODE.updateChild(\n      this.indexPath_,\n      valueNode\n    );\n    return new NamedNode(name, node);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  maxPost(): NamedNode {\n    const node = ChildrenNode.EMPTY_NODE.updateChild(this.indexPath_, MAX_NODE);\n    return new NamedNode(MAX_NAME, node);\n  }\n\n  /**\n   * @inheritDoc\n   */\n  toString(): string {\n    return this.indexPath_.slice().join('/');\n  }\n}\n"]},"metadata":{},"sourceType":"script"}