{"ast":null,"code":"\"use strict\";\n/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar util_1 = require(\"@firebase/util\");\n\nvar util_2 = require(\"@firebase/util\");\n\nvar storage_1 = require(\"./storage/storage\");\n\nvar Constants_1 = require(\"../realtime/Constants\");\n/**\n * A class that holds metadata about a Repo object\n *\n * @constructor\n */\n\n\nvar RepoInfo =\n/** @class */\nfunction () {\n  /**\n   * @param {string} host Hostname portion of the url for the repo\n   * @param {boolean} secure Whether or not this repo is accessed over ssl\n   * @param {string} namespace The namespace represented by the repo\n   * @param {boolean} webSocketOnly Whether to prefer websockets over all other transports (used by Nest).\n   * @param {string=} persistenceKey Override the default session persistence storage key\n   */\n  function RepoInfo(host, secure, namespace, webSocketOnly, persistenceKey) {\n    if (persistenceKey === void 0) {\n      persistenceKey = '';\n    }\n\n    this.secure = secure;\n    this.namespace = namespace;\n    this.webSocketOnly = webSocketOnly;\n    this.persistenceKey = persistenceKey;\n    this.host = host.toLowerCase();\n    this.domain = this.host.substr(this.host.indexOf('.') + 1);\n    this.internalHost = storage_1.PersistentStorage.get('host:' + host) || this.host;\n  }\n\n  RepoInfo.prototype.needsQueryParam = function () {\n    return this.host !== this.internalHost || this.isCustomHost();\n  };\n\n  RepoInfo.prototype.isCacheableHost = function () {\n    return this.internalHost.substr(0, 2) === 's-';\n  };\n\n  RepoInfo.prototype.isDemoHost = function () {\n    return this.domain === 'firebaseio-demo.com';\n  };\n\n  RepoInfo.prototype.isCustomHost = function () {\n    return this.domain !== 'firebaseio.com' && this.domain !== 'firebaseio-demo.com';\n  };\n\n  RepoInfo.prototype.updateHost = function (newHost) {\n    if (newHost !== this.internalHost) {\n      this.internalHost = newHost;\n\n      if (this.isCacheableHost()) {\n        storage_1.PersistentStorage.set('host:' + this.host, this.internalHost);\n      }\n    }\n  };\n  /**\n   * Returns the websocket URL for this repo\n   * @param {string} type of connection\n   * @param {Object} params list\n   * @return {string} The URL for this repo\n   */\n\n\n  RepoInfo.prototype.connectionURL = function (type, params) {\n    util_1.assert(typeof type === 'string', 'typeof type must == string');\n    util_1.assert(typeof params === 'object', 'typeof params must == object');\n    var connURL;\n\n    if (type === Constants_1.WEBSOCKET) {\n      connURL = (this.secure ? 'wss://' : 'ws://') + this.internalHost + '/.ws?';\n    } else if (type === Constants_1.LONG_POLLING) {\n      connURL = (this.secure ? 'https://' : 'http://') + this.internalHost + '/.lp?';\n    } else {\n      throw new Error('Unknown connection type: ' + type);\n    }\n\n    if (this.needsQueryParam()) {\n      params['ns'] = this.namespace;\n    }\n\n    var pairs = [];\n    util_2.forEach(params, function (key, value) {\n      pairs.push(key + '=' + value);\n    });\n    return connURL + pairs.join('&');\n  };\n  /** @return {string} */\n\n\n  RepoInfo.prototype.toString = function () {\n    var str = this.toURLString();\n\n    if (this.persistenceKey) {\n      str += '<' + this.persistenceKey + '>';\n    }\n\n    return str;\n  };\n  /** @return {string} */\n\n\n  RepoInfo.prototype.toURLString = function () {\n    return (this.secure ? 'https://' : 'http://') + this.host;\n  };\n\n  return RepoInfo;\n}();\n\nexports.RepoInfo = RepoInfo;","map":{"version":3,"sources":["../src/core/RepoInfo.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * Copyright 2017 Google Inc.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { assert } from '@firebase/util';\nimport { forEach } from '@firebase/util';\nimport { PersistentStorage } from './storage/storage';\nimport { LONG_POLLING, WEBSOCKET } from '../realtime/Constants';\n\n/**\n * A class that holds metadata about a Repo object\n *\n * @constructor\n */\nexport class RepoInfo {\n  host: string;\n  domain: string;\n  internalHost: string;\n\n  /**\n   * @param {string} host Hostname portion of the url for the repo\n   * @param {boolean} secure Whether or not this repo is accessed over ssl\n   * @param {string} namespace The namespace represented by the repo\n   * @param {boolean} webSocketOnly Whether to prefer websockets over all other transports (used by Nest).\n   * @param {string=} persistenceKey Override the default session persistence storage key\n   */\n  constructor(\n    host: string,\n    public secure: boolean,\n    public namespace: string,\n    public webSocketOnly: boolean,\n    public persistenceKey: string = ''\n  ) {\n    this.host = host.toLowerCase();\n    this.domain = this.host.substr(this.host.indexOf('.') + 1);\n    this.internalHost = PersistentStorage.get('host:' + host) || this.host;\n  }\n\n  needsQueryParam(): boolean {\n    return this.host !== this.internalHost || this.isCustomHost();\n  }\n\n  isCacheableHost(): boolean {\n    return this.internalHost.substr(0, 2) === 's-';\n  }\n\n  isDemoHost() {\n    return this.domain === 'firebaseio-demo.com';\n  }\n\n  isCustomHost() {\n    return (\n      this.domain !== 'firebaseio.com' && this.domain !== 'firebaseio-demo.com'\n    );\n  }\n\n  updateHost(newHost: string) {\n    if (newHost !== this.internalHost) {\n      this.internalHost = newHost;\n      if (this.isCacheableHost()) {\n        PersistentStorage.set('host:' + this.host, this.internalHost);\n      }\n    }\n  }\n\n  /**\n   * Returns the websocket URL for this repo\n   * @param {string} type of connection\n   * @param {Object} params list\n   * @return {string} The URL for this repo\n   */\n  connectionURL(type: string, params: { [k: string]: string }): string {\n    assert(typeof type === 'string', 'typeof type must == string');\n    assert(typeof params === 'object', 'typeof params must == object');\n\n    let connURL: string;\n    if (type === WEBSOCKET) {\n      connURL =\n        (this.secure ? 'wss://' : 'ws://') + this.internalHost + '/.ws?';\n    } else if (type === LONG_POLLING) {\n      connURL =\n        (this.secure ? 'https://' : 'http://') + this.internalHost + '/.lp?';\n    } else {\n      throw new Error('Unknown connection type: ' + type);\n    }\n    if (this.needsQueryParam()) {\n      params['ns'] = this.namespace;\n    }\n\n    const pairs: string[] = [];\n\n    forEach(params, (key: string, value: string) => {\n      pairs.push(key + '=' + value);\n    });\n\n    return connURL + pairs.join('&');\n  }\n\n  /** @return {string} */\n  toString(): string {\n    let str = this.toURLString();\n    if (this.persistenceKey) {\n      str += '<' + this.persistenceKey + '>';\n    }\n    return str;\n  }\n\n  /** @return {string} */\n  toURLString(): string {\n    return (this.secure ? 'https://' : 'http://') + this.host;\n  }\n}\n"]},"metadata":{},"sourceType":"script"}